!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("rxjs")):"function"==typeof define&&define.amd?define("@rxweb/http",["exports","rxjs"],e):e(((t=t||self).rxweb=t.rxweb||{},t.rxweb.http={}),t.rxjs)}(this,function(t,e){"use strict";var r=function(){return(r=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var s in e=arguments[r])Object.prototype.hasOwnProperty.call(e,s)&&(t[s]=e[s]);return t}).apply(this,arguments)};function n(t){return"undefined"!=typeof FormData&&t instanceof FormData}function s(t){return"undefined"!=typeof Blob&&t instanceof Blob}function o(t){return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer}function i(t){return""+function(t){var e="";t&&t.params&&t.params.length>0&&(e="/"+t.params.join("/"));return e}(t)+function(t){var e="?";t&&t.queryParams&&Object.keys(t.queryParams).forEach(function(r){e+=r+"="+t.queryParams[r]+"&"});return e.slice(0,e.length-1)}(t)}var u=function(){function t(t,e,r,n,s,o,i,u,h,a,p){this.body=t,this.headers=e,this.host=r,this.method=s,this.path=o,this.params=i,this.queryParams=u,this.responseType=h,this.scheme=a,h||(this.responseType="json"),this.isHttps=n,p&&(this.fullPath=p)}return Object.defineProperty(t.prototype,"isHttps",{get:function(){return this._isHttps},set:function(t){this._isHttps=t,t&&(this.fullPath=this.fullPath.replace("http:","https:"))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fullPath",{get:function(){return this._fullPath?this._fullPath:this.host+"/"+this.path+i({params:this.params,queryParams:this.queryParams})},set:function(t){this._fullPath=t},enumerable:!0,configurable:!0}),t.prototype.getContentType=function(){return null===this.body?null:n(this.body)?null:s(this.body)?this.body.type||null:o(this.body)?null:"string"==typeof this.body?"text/plain":"object"==typeof this.body||"number"==typeof this.body||Array.isArray(this.body)?"application/json":null},t.prototype.serializeBody=function(){return null===this.body?null:o(this.body)||s(this.body)||n(this.body)||"string"==typeof this.body?this.body:("PATCH"==this.method&&(this.body=this.convertPatchBody(this.body)),"object"==typeof this.body||"boolean"==typeof this.body||Array.isArray(this.body)?JSON.stringify(this.body):this.body?String(this.body):"")},t.prototype.convertPatchBody=function(t){var e=[];for(var r in t)e.push({op:"replace",path:"/"+r,value:t[r]});return e},t}();function h(t,e,r,n,s){if("string"!=typeof n){var o=function(t,e,r){return r&&r.hostUri?r.hostUri:e&&e.config&&e.config.hostKey?t.hostURIs.filter(function(t){return t.name==e.config.hostKey})[0].uri:t.hostURIs?t.hostURIs.filter(function(t){return 1==t.default})[0].uri:window.location.origin}(e,r,n),i=n&&n.path?n.path:r.config.path,h=o.startsWith("https://");return new u(n?n.body:void 0,{},o,h,t,i,n&&n.params?n.params:[],n&&n.queryParams?n.queryParams:{},n?n.responseType:void 0,h?"https":"http")}h=n.startsWith("https://");return new u(void 0,{},n,n.startsWith("https://"),t,n,[],{},void 0,h?"https":"http",n)}var a=new(function(){function t(){this.serviceContainers=new Array}return t.prototype.register=function(t,e,r){this.serviceContainers.filter(function(e){return e.target==t&&e.type==r})[0]||this.serviceContainers.push({target:t,config:e,type:r})},t.prototype.registerConfig=function(t){this.baseConfig=t},t.prototype.get=function(t){return this.serviceContainers.filter(function(e){return e.target==t})},t.prototype.getConfig=function(){return this.baseConfig},t}());var p=function(){},f=function(){function t(t,e){this.request=t,this.response=e,this.response||(this.response=new p)}return Object.defineProperty(t.prototype,"result",{get:function(){return this._result},set:function(t){this._result=t,this.response.isInMemoryResponse=!0},enumerable:!0,configurable:!0}),t}(),c=function(){},l=function(){function t(t,e,r,n){var s=this;this.request=t,this.onComplete=e,this.onRequestError=r,this.badRequest=n,this.onLoad=function(){var t,e,r,n=new p;n.statusCode=s.xhr.status,n.statusText=s.xhr.statusText||"OK",n.headers=(t=s.xhr.getAllResponseHeaders(),e=t.trim().split(/[\r\n]+/),r={},e.forEach(function(t){var e=t.split(": "),n=e.shift(),s=e.join(": ");r[n]=s}),r),n.responseUrl=s.xhr.responseURL;var o=null;204!==n.statusCode&&(o=void 0===s.xhr.response?s.xhr.responseText:s.xhr.response),0===n.statusCode&&(n.statusCode=o?200:0);var i=n.statusCode>=200&&n.statusCode<300;if("json"===s.request.responseType&&n.headers["content-type"]&&-1!=n.headers["content-type"].indexOf("json")&&"string"==typeof o){var u=o;o=o.replace(/^\)\]\}',?\n/,"");try{o=""!==o?JSON.parse(o):null}catch(t){o=u,i&&(i=!1,o={ex:t,body:o})}}n.body=o,i?(s.onComplete(n),s.dispose()):s.onError(n)},this.onError=function(t){400==s.xhr.status&&s.badRequest?s.badRequest(void 0===s.xhr.response?s.xhr.responseText:s.xhr.response):s.onRequestError?s.onRequestError({responseUrl:s.xhr.responseURL,error:t,statusCode:s.xhr.status||0,statusText:s.xhr.statusText||"Unknown Error"}):console.error(t),s.dispose()};var o=new XMLHttpRequest;if(o.open(t.method,t.fullPath),Object.keys(t.headers).forEach(function(e){return o.setRequestHeader(e,t.headers[e])}),t.headers.Accept||o.setRequestHeader("Accept","application/json, text/plain, */*"),!t.headers["Content-Type"]){var i=t.getContentType();null!==i&&o.setRequestHeader("Content-Type",i)}o.addEventListener("load",this.onLoad),o.addEventListener("error",this.onError),o.withCredentials=!0,o.send(t.serializeBody()),this.xhr=o}return t.prototype.dispose=function(){this.xhr&&(this.xhr.removeEventListener("load",this.onLoad),this.xhr.removeEventListener("error",this.onError)),this.xhr=null,this.request=null,this.onComplete=null,this.onRequestError=null,this.badRequest=null},t}();var y=function(){function t(t,e,n,s,o){var i=this;this.request=t,this.filters=e,this.inMemoryFilter=n,this.onError=s,this.badRequest=o,this._index=0,this._onResponse=new Array,this.onRequestExecuting=function(){return function(t){if(t.response.statusCode){var e=r({},t.response,{body:t.result});e.statusCode>=200&&e.statusCode<300?i._onSuccess(e):(i._onError.error(e),i.onError(e))}else i.executeFilterOnRequest()}}}return t.prototype.process=function(t,e){this._onSuccess=this.onComplete(t,e),this._onError=e,this.inMemoryFilter?this.callFilter(this.inMemoryFilter):this.executeFilterOnRequest()},t.prototype.executeFilterOnRequest=function(){this.filters&&this.filters.length>0&&this.filters.length>this._index?this.callFilter(this.filters[this._index]):new l(this.request,this._onSuccess,this.onRequestError.bind(this),this.badRequest)},t.prototype.callFilter=function(t){if(t.runsOn&&-1==t.runsOn.indexOf(this.request.method))this._index++;else{var e=function(t,e){var r=Object.create(t.prototype);try{t.apply(r,e)}catch(n){r=Reflect.construct(t,e)}return r}(t.model,t.args||[]);e.onRequestExecuting=this.onRequestExecuting(),this._index++,e.onRequest(new f(this.request,new p)),e.onResponse&&this._onResponse.push(e)}},t.prototype.onComplete=function(t,e){var r=this;return function(t){r._onResponse.length>0&&!t.isInMemoryResponse&&r._onResponse.forEach(function(e){return e.onResponse(t)}),e.next(t.body),e.complete()}},t.prototype.onRequestError=function(t){this._onError.error(t),this.onError&&this.onError(t)},t}(),d=function(){function t(){}return t.prototype.getFilters=function(){var t=this._baseConfig&&this._baseConfig.filters?this._baseConfig.filters:[],e=this._serviceContainers.filter(function(t){return"filter"==t.type})[0],r=[];return e&&e.config.forEach(function(t){return r.push(t)}),t.forEach(function(t){return r.push(t)}),r},t.prototype.getInMemoryFilter=function(){return this._serviceContainers.filter(function(t){return"inmemory"==t.type})[0]&&this._baseConfig&&this._baseConfig.filters?this._baseConfig.filters.filter(function(t){return t.isInMemory})[0]:null},t.prototype.request=function(t,r){var n=this;return new e.Observable(function(e){n._baseConfig||(n._baseConfig=a.getConfig()||{}),n._serviceContainers||(n._serviceContainers=function(t){var e=a.get(t.constructor),r=e&&0!=e.length?{}:t.__proto__;if(r.__proto__){var n=!1;do{(n=r.__proto__.constructor!=Object)&&(n=null==(e=a.get(r.__proto__.constructor)))}while(n)}return e}(n));var s=n._serviceContainers.filter(function(t){return"http"==t.type})[0],o=h(t,n._baseConfig,s,r);if(o){var i=n._baseConfig?n._baseConfig.onError:null;new y(o,n.getFilters(),n.getInMemoryFilter(),n.onError||i,n.badRequest).process("subscribe",e)}else e.next(null),e.complete()})},t.prototype.lookup=function(t){var r=this;return new e.Observable(function(e){var n=[],s=[],o={};t.forEach(function(t){n.push(t.propName),s.push(r.get(t).subscribe(function(r){o[t.propName]=r,Object.keys(o).length==n.length&&(e.next(o),e.complete())}))})})},t.prototype.get=function(t){return this.request("GET",t)},t.prototype.post=function(t){return this.request("POST",t)},t.prototype.put=function(t){return this.request("PUT",t)},t.prototype.patch=function(t){return this.request("PATCH",t)},t.prototype.delete=function(t){return this.request("DELETE",t)},t}();var b=function(){function t(){}return t.register=function(t){a.registerConfig(t)},t}();t.AbstractRequestFilter=c,t.HttpClientConfig=b,t.HttpResponse=p,t.RxHttp=d,t.XhrContext=f,t.http=function(t){return function(e){a.register(e,t,"http")}},t.inMemory=function(){return function(t){a.register(t,null,"inmemory")}},t.xhrFilter=function(t){return function(e){a.register(e,t,"filter")}},Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=rxweb-http.umd.min.js.map