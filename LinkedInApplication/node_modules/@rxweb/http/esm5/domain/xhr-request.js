import { HttpResponse } from '../models';
import { extractHeaders } from "../functions/util";
var XhrRequest = /** @class */ (function () {
    function XhrRequest(request, onComplete, onRequestError, badRequest) {
        var _this = this;
        this.request = request;
        this.onComplete = onComplete;
        this.onRequestError = onRequestError;
        this.badRequest = badRequest;
        this.onLoad = function () {
            var response = new HttpResponse();
            response.statusCode = _this.xhr.status;
            response.statusText = _this.xhr.statusText || 'OK';
            response.headers = extractHeaders(_this.xhr.getAllResponseHeaders());
            response.responseUrl = _this.xhr.responseURL;
            var body = null;
            if (response.statusCode !== 204)
                body = typeof _this.xhr.response === 'undefined' ? _this.xhr.responseText : _this.xhr.response;
            if (response.statusCode === 0)
                response.statusCode = !!body ? 200 : 0;
            var isSuccess = response.statusCode >= 200 && response.statusCode < 300;
            if (_this.request.responseType === 'json' && response.headers["content-type"] && response.headers["content-type"].indexOf("json") != -1 && typeof body === 'string') {
                var originalBody = body;
                body = body.replace(/^\)\]\}',?\n/, '');
                try {
                    body = body !== '' ? JSON.parse(body) : null;
                }
                catch (ex) {
                    body = originalBody;
                    if (isSuccess) {
                        isSuccess = false;
                        body = { ex: ex, body: body };
                    }
                }
            }
            response.body = body;
            if (isSuccess) {
                _this.onComplete(response);
                _this.dispose();
            }
            else
                _this.onError(response);
        };
        this.onError = function (error) {
            if (_this.xhr.status == 400 && _this.badRequest)
                _this.badRequest(typeof _this.xhr.response === 'undefined' ? _this.xhr.responseText : _this.xhr.response);
            else if (_this.onRequestError)
                _this.onRequestError({
                    responseUrl: _this.xhr.responseURL,
                    error: error,
                    statusCode: _this.xhr.status || 0,
                    statusText: _this.xhr.statusText || 'Unknown Error'
                });
            else
                console.error(error);
            _this.dispose();
        };
        var xhr = new XMLHttpRequest();
        xhr.open(request.method, request.fullPath);
        Object.keys(request.headers).forEach(function (t) { return xhr.setRequestHeader(t, request.headers[t]); });
        if (!request.headers['Accept'])
            xhr.setRequestHeader('Accept', 'application/json, text/plain, */*');
        if (!request.headers['Content-Type']) {
            var contentType = request.getContentType();
            if (contentType !== null) {
                xhr.setRequestHeader('Content-Type', contentType);
            }
        }
        xhr.addEventListener('load', this.onLoad);
        xhr.addEventListener('error', this.onError);
        xhr.withCredentials = true;
        xhr.send(request.serializeBody());
        this.xhr = xhr;
    }
    XhrRequest.prototype.dispose = function () {
        if (this.xhr) {
            this.xhr.removeEventListener('load', this.onLoad);
            this.xhr.removeEventListener('error', this.onError);
        }
        this.xhr = null;
        this.request = null;
        this.onComplete = null;
        this.onRequestError = null;
        this.badRequest = null;
    };
    return XhrRequest;
}());
export { XhrRequest };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoieGhyLXJlcXVlc3QuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9Acnh3ZWIvaHR0cC8iLCJzb3VyY2VzIjpbImRvbWFpbi94aHItcmVxdWVzdC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQWUsWUFBWSxFQUFDLE1BQU0sV0FBVyxDQUFBO0FBQ3BELE9BQU8sRUFBRSxjQUFjLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQztBQUVuRDtJQUdJLG9CQUFvQixPQUFvQixFQUFVLFVBQW9CLEVBQVUsY0FBd0IsRUFBVSxVQUFvQjtRQUF0SSxpQkFxQkM7UUFyQm1CLFlBQU8sR0FBUCxPQUFPLENBQWE7UUFBVSxlQUFVLEdBQVYsVUFBVSxDQUFVO1FBQVUsbUJBQWMsR0FBZCxjQUFjLENBQVU7UUFBVSxlQUFVLEdBQVYsVUFBVSxDQUFVO1FBdUJ0SSxXQUFNLEdBQUc7WUFDTCxJQUFJLFFBQVEsR0FBRyxJQUFJLFlBQVksRUFBRSxDQUFDO1lBQ2xDLFFBQVEsQ0FBQyxVQUFVLEdBQUcsS0FBSSxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUE7WUFDckMsUUFBUSxDQUFDLFVBQVUsR0FBRyxLQUFJLENBQUMsR0FBRyxDQUFDLFVBQVUsSUFBSSxJQUFJLENBQUM7WUFDbEQsUUFBUSxDQUFDLE9BQU8sR0FBRyxjQUFjLENBQUMsS0FBSSxDQUFDLEdBQUcsQ0FBQyxxQkFBcUIsRUFBRSxDQUFDLENBQUE7WUFDbkUsUUFBUSxDQUFDLFdBQVcsR0FBRyxLQUFJLENBQUMsR0FBRyxDQUFDLFdBQVcsQ0FBQztZQUM1QyxJQUFJLElBQUksR0FBUSxJQUFJLENBQUM7WUFFckIsSUFBSSxRQUFRLENBQUMsVUFBVSxLQUFLLEdBQUc7Z0JBQzNCLElBQUksR0FBRyxPQUFPLEtBQUksQ0FBQyxHQUFHLENBQUMsUUFBUSxLQUFLLFdBQVcsQ0FBQyxDQUFDLENBQUMsS0FBSSxDQUFDLEdBQUcsQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFDLEtBQUksQ0FBQyxHQUFHLENBQUMsUUFB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Q3ZCLElBQUksQ0FBQyxjQUFjLEdBQUcsSUFBSSxDQUFDO1FBQzNCLElBQUksQ0FBQyxVQUFVLEdBQUcsSUFBSSxDQUFDO0lBQzNCLENBQUM7SUFDTCxpQkFBQztBQUFELENBQUMsQUEzRkQsSUEyRkMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBIdHRwUmVxdWVzdCwgSHR0cFJlc3BvbnNlfSBmcm9tICcuLi9tb2RlbHMnXHJcbmltcG9ydCB7IGV4dHJhY3RIZWFkZXJzIH0gZnJvbSBcIi4uL2Z1bmN0aW9ucy91dGlsXCI7XHJcblxyXG5leHBvcnQgY2xhc3MgWGhyUmVxdWVzdCB7XHJcbiAgICB4aHI6IFhNTEh0dHBSZXF1ZXN0O1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgcmVxdWVzdDogSHR0cFJlcXVlc3QsIHByaXZhdGUgb25Db21wbGV0ZTogRnVuY3Rpb24sIHByaXZhdGUgb25SZXF1ZXN0RXJyb3I6IEZ1bmN0aW9uLCBwcml2YXRlIGJhZFJlcXVlc3Q6IEZ1bmN0aW9uKSB7XHJcbiAgICAgICAgbGV0IHhociA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpO1xyXG4gICAgICAgIHhoci5vcGVuKHJlcXVlc3QubWV0aG9kLCByZXF1ZXN0LmZ1bGxQYXRoKTtcclxuICAgICAgICBPYmplY3Qua2V5cyhyZXF1ZXN0LmhlYWRlcnMpLmZvckVhY2godCA9PiB4aHIuc2V0UmVxdWVzdEhlYWRlcih0LCByZXF1ZXN0LmhlYWRlcnNbdF0pKTtcclxuXHJcbiAgICAgICAgaWYgKCFyZXF1ZXN0LmhlYWRlcnNbJ0FjY2VwdCddKVxyXG4gICAgICAgICAgICB4aHIuc2V0UmVxdWVzdEhlYWRlcignQWNjZXB0JywgJ2FwcGxpY2F0aW9uL2pzb24sIHRleHQvcGxhaW4sICovKicpO1xyXG5cclxuICAgICAgICBpZiAoIXJlcXVlc3QuaGVhZGVyc1snQ29udGVudC1UeXBlJ10pIHtcclxuICAgICAgICAgICAgY29uc3QgY29udGVudFR5cGUgPSByZXF1ZXN0LmdldENvbnRlbnRUeXBlKCk7XHJcbiAgICAgICAgICAgIGlmIChjb250ZW50VHlwZSAhPT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgeGhyLnNldFJlcXVlc3RIZWFkZXIoJ0NvbnRlbnQtVHlwZScsIGNvbnRlbnRUeXBlKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgeGhyLmFkZEV2ZW50TGlzdGVuZXIoJ2xvYWQnLCB0aGlzLm9uTG9hZCk7XHJcbiAgICAgICAgeGhyLmFkZEV2ZW50TGlzdGVuZXIoJ2Vycm9yJywgdGhpcy5vbkVycm9yKTtcclxuICAgICAgICB4aHIud2l0aENyZWRlbnRpYWxzID0gdHJ1ZTtcclxuICAgICAgICB4aHIuc2VuZChyZXF1ZXN0LnNlcmlhbGl6ZUJvZHkoKSk7XHJcblxyXG4gICAgICAgIHRoaXMueGhyID0geGhyO1xyXG4gICAgfVxyXG5cclxuICAgIG9uTG9hZCA9ICgpID0+IHtcclxuICAgICAgICBsZXQgcmVzcG9uc2UgPSBuZXcgSHR0cFJlc3BvbnNlKCk7XHJcbiAgICAgICAgcmVzcG9uc2Uuc3RhdHVzQ29kZSA9IHRoaXMueGhyLnN0YXR1c1xyXG4gICAgICAgIHJlc3BvbnNlLnN0YXR1c1RleHQgPSB0aGlzLnhoci5zdGF0dXNUZXh0IHx8ICdPSyc7XHJcbiAgICAgICAgcmVzcG9uc2UuaGVhZGVycyA9IGV4dHJhY3RIZWFkZXJzKHRoaXMueGhyLmdldEFsbFJlc3BvbnNlSGVhZGVycygpKVxyXG4gICAgICAgIHJlc3BvbnNlLnJlc3BvbnNlVXJsID0gdGhpcy54aHIucmVzcG9uc2VVUkw7XHJcbiAgICAgICAgbGV0IGJvZHk6IGFueSA9IG51bGw7XHJcblxyXG4gICAgICAgIGlmIChyZXNwb25zZS5zdGF0dXNDb2RlICE9PSAyMDQpXHJcbiAgICAgICAgICAgIGJvZHkgPSB0eXBlb2YgdGhpcy54aHIucmVzcG9uc2UgPT09ICd1bmRlZmluZWQnID8gdGhpcy54aHIucmVzcG9uc2VUZXh0IDogdGhpcy54aHIucmVzcG9uc2U7XHJcblxyXG4gICAgICAgIGlmIChyZXNwb25zZS5zdGF0dXNDb2RlID09PSAwKVxyXG4gICAgICAgICAgICByZXNwb25zZS5zdGF0dXNDb2RlID0gISFib2R5ID8gMjAwIDogMDtcclxuXHJcbiAgICAgICAgbGV0IGlzU3VjY2VzcyA9IHJlc3BvbnNlLnN0YXR1c0NvZGUgPj0gMjAwICYmIHJlc3BvbnNlLnN0YXR1c0NvZGUgPCAzMDA7XHJcbiAgICAgICAgaWYgKHRoaXMucmVxdWVzdC5yZXNwb25zZVR5cGUgPT09ICdqc29uJyAmJiByZXNwb25zZS5oZWFkZXJzW1wiY29udGVudC10eXBlXCJdICYmIHJlc3BvbnNlLmhlYWRlcnNbXCJjb250ZW50LXR5cGVcIl0uaW5kZXhPZihcImpzb25cIikgIT0gLTEgJiYgdHlwZW9mIGJvZHkgPT09ICdzdHJpbmcnKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IG9yaWdpbmFsQm9keSA9IGJvZHk7XHJcbiAgICAgICAgICAgIGJvZHkgPSBib2R5LnJlcGxhY2UoL15cXClcXF1cXH0nLD9cXG4vLCAnJyk7XHJcbiAgICAgICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgICAgICBib2R5ID0gYm9keSAhPT0gJycgPyBKU09OLnBhcnNlKGJvZHkpIDogbnVsbDtcclxuICAgICAgICAgICAgfSBjYXRjaCAoZXgpIHtcclxuICAgICAgICAgICAgICAgIGJvZHkgPSBvcmlnaW5hbEJvZHk7XHJcbiAgICAgICAgICAgICAgICBpZiAoaXNTdWNjZXNzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaXNTdWNjZXNzID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgYm9keSA9IHsgZXgsIGJvZHk6IGJvZHkgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJlc3BvbnNlLmJvZHkgPSBib2R5O1xyXG4gICAgICAgIGlmIChpc1N1Y2Nlc3MpIHtcclxuICAgICAgICAgICAgdGhpcy5vbkNvbXBsZXRlKHJlc3BvbnNlKVxyXG4gICAgICAgICAgICB0aGlzLmRpc3Bvc2UoKVxyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgIHRoaXMub25FcnJvcihyZXNwb25zZSk7XHJcbiAgICAgICAgXHJcbiAgICB9XHJcblxyXG4gICAgb25FcnJvciA9IChlcnJvcikgPT4ge1xyXG4gICAgICAgIGlmICh0aGlzLnhoci5zdGF0dXMgPT0gNDAwICYmIHRoaXMuYmFkUmVxdWVzdClcclxuICAgICAgICAgICAgdGhpcy5iYWRSZXF1ZXN0KHR5cGVvZiB0aGlzLnhoci5yZXNwb25zZSA9PT0gJ3VuZGVmaW5lZCcgPyB0aGlzLnhoci5yZXNwb25zZVRleHQgOiB0aGlzLnhoci5yZXNwb25zZSlcclxuICAgICAgICBlbHNlIGlmICh0aGlzLm9uUmVxdWVzdEVycm9yKVxyXG4gICAgICAgICAgICB0aGlzLm9uUmVxdWVzdEVycm9yKHtcclxuICAgICAgICAgICAgICAgIHJlc3BvbnNlVXJsOiB0aGlzLnhoci5yZXNwb25zZVVSTCxcclxuICAgICAgICAgICAgICAgIGVycm9yOiBlcnJvcixcclxuICAgICAgICAgICAgICAgIHN0YXR1c0NvZGU6IHRoaXMueGhyLnN0YXR1cyB8fCAwLFxyXG4gICAgICAgICAgICAgICAgc3RhdHVzVGV4dDogdGhpcy54aHIuc3RhdHVzVGV4dCB8fCAnVW5rbm93biBFcnJvcidcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKGVycm9yKTtcclxuICAgICAgICB0aGlzLmRpc3Bvc2UoKTtcclxuICAgIH1cclxuXHJcblxyXG4gICAgZGlzcG9zZSgpIHtcclxuICAgICAgICBpZiAodGhpcy54aHIpIHtcclxuICAgICAgICAgICAgdGhpcy54aHIucmVtb3ZlRXZlbnRMaXN0ZW5lcignbG9hZCcsIHRoaXMub25Mb2FkKTtcclxuICAgICAgICAgICAgdGhpcy54aHIucmVtb3ZlRXZlbnRMaXN0ZW5lcignZXJyb3InLCB0aGlzLm9uRXJyb3IpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLnhociA9IG51bGw7XHJcbiAgICAgICAgdGhpcy5yZXF1ZXN0ID0gbnVsbDtcclxuICAgICAgICB0aGlzLm9uQ29tcGxldGUgPSBudWxsO1xyXG4gICAgICAgIHRoaXMub25SZXF1ZXN0RXJyb3IgPSBudWxsO1xyXG4gICAgICAgIHRoaXMuYmFkUmVxdWVzdCA9IG51bGw7XHJcbiAgICB9XHJcbn0iXX0=