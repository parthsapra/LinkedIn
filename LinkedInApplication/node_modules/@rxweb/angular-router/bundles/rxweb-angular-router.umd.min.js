!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/core"),require("@angular/router"),require("@angular/common"),require("@rxweb/http"),require("@rxweb/storage")):"function"==typeof define&&define.amd?define("@rxweb/angular-router",["exports","@angular/core","@angular/router","@angular/common","@rxweb/http","@rxweb/storage"],e):e(((t=t||self).rxweb=t.rxweb||{},t.rxweb["angular-router"]={}),t.ng.core,t.ng.router,t.ng.common,t["@rxweb/http"],t["@rxweb/storage"])}(this,function(t,e,n,r,o,i){"use strict";var a=function(t,e){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function c(t,e){function n(){this.constructor=t}a(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}function u(t,e,n,r){var o,i=arguments.length,a=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var c=t.length-1;c>=0;c--)(o=t[c])&&(a=(i<3?o(a):i>3?o(e,n,a):o(e,n))||a);return i>3&&a&&Object.defineProperty(e,n,a),a}function s(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)}function f(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,o,i=n.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(t){o={error:t}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a}function p(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(f(arguments[e]));return t}var h=new(function(){function t(){this.state={},this.modelDecorators=new Array}return t.prototype.add=function(t){this.state=t},t.prototype.get=function(){return this.state},t.prototype.getUser=function(){return this.user},t.prototype.setUser=function(t){this.user=t},t.prototype.addModelDecorator=function(t,e,n){this.modelDecorators.push({target:t,functions:e,type:n})},t.prototype.getModelDecorator=function(t,e){return this.modelDecorators.filter(function(n){return n.target==t&&n.type==e})[0]},t}());var d=new(function(){function t(){this.instances=new Array}return t.prototype.broadCastParamChange=function(t){Object.keys(t).length>0&&this.instances.forEach(function(e){e.paramChanged(t)})},t.prototype.broadCastQueryParamChange=function(t){Object.keys(t).length>0&&this.instances.forEach(function(e){e.queryParamChanged(t)})},t.prototype.setComponentRoute=function(t,e){this.activatedRouteSnapshot=t,this.router=e,this.broadCastParamChange(t.params),this.broadCastQueryParamChange(t.queryParams)},t.prototype.setAuthroizeConfig=function(t){this.authorizeConfig=t},t.prototype.getAuthorizeConfig=function(){return this.authorizeConfig},t.prototype.getResult=function(){return{activatedRouteSnapshot:this.activatedRouteSnapshot,router:this.router,authorizeConfig:this.authorizeConfig}},t.prototype.getActivatedRouteSnapshot=function(){return this.activatedRouteSnapshot},t.prototype.getRouter=function(){return this.router},t.prototype.add=function(t,e,n,r){this.instances.push({name:t,resolver:e,paramChanged:n,queryParamChanged:r})},t.prototype.resolve=function(t){var e=this.instances.filter(function(e){return e.name==t.name})[0];if(e)return e.resolver();throw new Error("Component instance is not available")},t.prototype.dispose=function(t){for(var e=this.instances.filter(function(e){return e.name==t.name}),n=e.length,r=0;r<n;r++)e.splice(0,1)},t}());function l(t,e,n){return function(r){var o=h.get().middlewares,i=h.getModelDecorator(e.component,"middleware");i&&(o=o?p(o,i.functions):p(i.functions)),o?function t(e,n,r,o,i,a){a=null==a?0:a+1;var c=n.get(i[a]);if(c){var u=c.invoke(e,r);u instanceof Promise?u.then(function(c){c&&i.length>a+1?t(e,n,r,o,i,a):o(c)}):u&&i.length>a+1?t(e,n,r,o,i,a):o(u)}else o(!0)}(r,t,e,n,o):n(!0)}}var v=new(function(){function t(){}return t.prototype.decode=function(t){return t=t.replace("00","=").replace("00","="),atob(t)},t.prototype.encode=function(t){return btoa(t).replace("=","00").replace("=","00")},t}());var g=function(){function t(t,e){this.activatedRoute=t,this.router=e}return t=u([e.Injectable(),s("design:paramtypes",[n.ActivatedRoute,n.Router])],t)}(),y=function(){function t(t,e){this.injector=t,this.paramResolver=e}return t.prototype.canActivate=function(t,e){var n=this;return new Promise(function(e,r){!function(t){if(h.get().urlEncryption){var e={};Object.keys(t.params).forEach(function(n){var r=v.decode(t.params[n]);Object.defineProperty(e,n,{get:function(){return r}})}),delete t.params,t.params=Object.preventExtensions(e)}}(t);var o,i,a=n.resolveRoute(e,t);!function(t,e,n,r){var o=h.getModelDecorator(e.component,"access"),i=h.getModelDecorator(e.component,"anonymous");if(o){var a=h.get().authorization;if(a){var c=t.get(a).authorize(o.functions,e);c instanceof Promise?c.then(function(t){t?(d.setAuthroizeConfig(o.functions),n(i)):r(!1)}):!0===c?(d.setAuthroizeConfig(o.functions),n(i)):r(c)}else n(i)}else n(i)}(n.injector,t,(o=n.injector,i=l(n.injector,t,a),function(t){if(t)i(n);else{var e=h.get().authentication;if(e){var n=o.get(e).resolveAuth();n instanceof Promise?n.then(function(t){h.setUser(t),i(t)}):(h.setUser(n),i(n))}else i(n)}}),a)})},t.prototype.resolveRoute=function(t,e){var r=this;return function(o){o&&d.setComponentRoute(e,r.injector.get(n.Router)),t(o)}},t=u([e.Injectable(),s("design:paramtypes",[e.Injector,g])],t)}(),m=function(){function t(){}return t.prototype.canDeactivate=function(t,e,n,r){return!t.canDeactivate||t.canDeactivate(e,n,r)},t=u([e.Injectable(),s("design:paramtypes",[])],t)}();function R(t){var e=t.split("/");t="";return e.forEach(function(e){var n=":"==e.charAt(0);""==t&&n?t=e:t+=n?"/"+e:""===t?""+v.encode(e):"/"+v.encode(e)}),t}var C=function(){function t(){}return t.addRoute=function(t){this.addCanActivate(t),this.addCanDeactivate(t),this._routes.push(t)},t.applyRootRoutes=function(t){this.routes=[];var e=t||p(this._routes);h.get().urlEncryption&&e.forEach(function(t){t.path=R(t.path)}),this._routes=[],this.routes=e},t.addCanActivate=function(t){t.canActivate?t.canActivate.push(y):t.canActivate=[y]},t.addCanDeactivate=function(t){t.canDeactivate?t.canDeactivate.push(m):t.canDeactivate=[m]},t.routes=[],t._routes=[],t}();var w=function(t){function o(e,n,r){var o=t.call(this,e,n,r)||this;return o.isPushed=!1,o.overrideProp(),o}return c(o,t),o.prototype.overrideProp=function(){var t=[];Object.defineProperty(this,"commands",{get:function(){var e=h.get().urlEncryption;return Array.isArray(t)&&Array.isArray(this.params)&&!this.isPushed&&(this.params.forEach(function(n){var r=e?v.encode(n):n;t.push(r)}),this.isPushed=!0),t},set:function(e){t=e}})},u([e.Input(),s("design:type",Array)],o.prototype,"params",void 0),o=u([e.Directive({selector:"a[routerLink],area[routerLink]"}),s("design:paramtypes",[n.Router,n.ActivatedRoute,r.LocationStrategy])],o)}(n.RouterLinkWithHref),b=function(){function t(t,e,n){this.viewContainerRef=t,this.templateRef=e,this.injector=n,this.viewRef=null,this._context=new r.NgIfContext}return Object.defineProperty(t.prototype,"component",{set:function(t){Array.isArray(t)?(this._components=t,this.checkAuth(0)):t&&this.checkAccess(t)},enumerable:!0,configurable:!0}),t.prototype.checkAuth=function(t){this._components.length>t?this.checkAccess(this._components[t],t):this.updateView(!0)},t.prototype.checkAccess=function(t,e){var n=this;void 0===e&&(e=0);var r=h.get().authorization,o=h.getModelDecorator(t,"access");if(r&&o){var i=this.injector.get(r),a=d.getAuthorizeConfig(),c=i.authorizeChildren(o.functions,a);if("boolean"==typeof c)if(this._components&&this._components.length>0&&c){var u=e+1;this.checkAuth(u)}else this.updateView(c);else c.then(function(t){if(t){var r=e+1;n.checkAuth(r)}else n.updateView(t)})}},t.prototype.updateView=function(t){this.viewRef&&(this.viewContainerRef.clear(),this.viewRef=null),t?this.viewRef=this.viewContainerRef.createEmbeddedView(this.templateRef,this._context):this.viewContainerRef.clear()},u([e.Input("rxAuthorize"),s("design:type",Object),s("design:paramtypes",[Object])],t.prototype,"component",null),t=u([e.Directive({selector:"[rxAuthorize]"}),s("design:paramtypes",[e.ViewContainerRef,e.TemplateRef,e.Injector])],t)}(),P=function(){function t(t,e,n){this.viewContainerRef=t,this.templateRef=e,this.injector=n,this.viewRef=null,this._context=new r.NgIfContext}return Object.defineProperty(t.prototype,"component",{set:function(t){var e=this,n=h.get().childMultilingualResolver;if(n){var r=this.injector.get(n).resolveChildren(this.viewContainerRef._view.component.constructor);"boolean"==typeof r?this.updateView(r):r.then(function(t){e.updateView(t)})}},enumerable:!0,configurable:!0}),t.prototype.updateView=function(t){this.viewRef&&(this.viewContainerRef.clear(),this.viewRef=null),t?this.viewRef=this.viewContainerRef.createEmbeddedView(this.templateRef,this._context):this.viewContainerRef.clear()},u([e.Input("rxMultilingual"),s("design:type",Object),s("design:paramtypes",[Object])],t.prototype,"component",null),t=u([e.Directive({selector:"[rxMultilingual]"}),s("design:paramtypes",[e.ViewContainerRef,e.TemplateRef,e.Injector])],t)}(),A=function(){function t(){}return t=u([e.NgModule({declarations:[w,b,P],exports:[w,b,P],providers:[y,m,g]})],t)}(),j=function(){};var x=function(t){function e(){var e=t.call(this)||this,n=d.getResult();if(n&&n.activatedRouteSnapshot){e.params=n.activatedRouteSnapshot.params,e.queryParams=n.activatedRouteSnapshot.queryParams,e.navigation=n.router,e.user=h.getUser(),e.data=n.activatedRouteSnapshot.data,e.storage=new i.ClientDataStorage,e.parentAuthorizeConfig=n.authorizeConfig;var r=h.getModelDecorator(e.constructor,"access");r&&(e.authorizeConfig=r.functions),d.add(e.constructor.name,e.instanceProvider.bind(e),e.paramsChange.bind(e),e.queryParamsChange.bind(e))}return e}return c(e,t),e.prototype.onQueryParamsChanged=function(){},e.prototype.onParamsChanged=function(){},e.prototype.instanceProvider=function(){return this},e.prototype.resolve=function(t){return d.resolve(t.constructor)},e.prototype.navigate=function(t,e){return this.navigation.navigate(t.concat(this.getParsedParams(e)),e)},e.prototype.ngOnDestroy=function(){d.dispose(this.constructor)},e.prototype.paramsChange=function(t){this.params=t,this.onParamsChanged()},e.prototype.queryParamsChange=function(t){this.queryParams=t,this.onQueryParamsChanged()},e.prototype.getParsedParams=function(t){var e=[];if(t&&t.params){var n=h.get().urlEncryption;t.params.forEach(function(t){var r=n?v.encode(t):t;e.push(r)})}return e},e}(o.RxHttp);t.AuthorizeConfig=j,t.BaseCanActivate=y,t.BaseCanDeactivate=m,t.CoreComponent=x,t.RouteProvider=C,t.RxRoutingModule=A,t.access=function(t){return function(e){h.addModelDecorator(e,t,"access")}},t.anonymous=function(){return function(t){h.addModelDecorator(t,null,"anonymous")}},t.middleware=function(t){return function(e){h.addModelDecorator(e,t,"middleware")}},t.route=function(t){return function(e){t.component=e,C.addRoute(t)}},t.routerModule=function(t){return function(e){h.add(t)}},t.routes=function(t){var e=[];return t.forEach(function(t){t.path&&(t.path=R(t.path)),t.redirectTo&&(t.redirectTo=R(t.redirectTo)),e.push(t)}),e},t.ɵa=w,t.ɵb=b,t.ɵc=P,t.ɵd=g,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=rxweb-angular-router.umd.min.js.map